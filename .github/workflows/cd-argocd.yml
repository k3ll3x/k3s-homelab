name: CD - ArgoCD Sync
on:
  workflow_run:
    workflows: ["CI - Build & Push"]
    types: [completed]

jobs:
  sync:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
    - uses: actions/checkout@v4
    
    - name: Trigger ArgoCD sync
      run: |
        curl -X POST \
          -H "Authorization: Bearer ${{ secrets.ARGOCD_TOKEN }}" \
          -H "Content-Type: application/json" \
          https://argocd.local:8080/api/v1/applications/registry-app/sync
